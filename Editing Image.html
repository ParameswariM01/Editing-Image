<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Editor</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif,  text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.5);
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: url("https://i.pinimg.com/736x/7e/1b/d8/7e1bd8301928366045d275c6f83ec6a3.jpg");
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-size: 100% 100%;
        }

        .container {
            width: 400px;
            height: 400px;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            opacity: 0;
            animation: fadeIn 1s forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        .form-container {
            position: absolute;
            width: 100%;
            height: 100%;
            transition: transform 0.5s ease-in-out;
            padding: 20px;
        }

        .login-form {
            transform: translateX(0);
        }

        .register-form {
            transform: translateX(100%);
        }

        .forgot-password-form {
            transform: translateX(-100%);
        }

        .container.active-register .login-form {
            transform: translateX(-100%);
        }

        .container.active-register .register-form {
            transform: translateX(0);
        }

        .container.active-forgot .login-form {
            transform: translateX(100%);
        }

        .container.active-forgot .forgot-password-form {
            transform: translateX(0);
        }

        h1 {
            margin-bottom: 20px;
        }

        input, button, select {
            margin: 10px 0;
            padding: 10px 15px; 
            font-size: 1rem; 
            border: none;
            border-radius: 5px;
        }

        button {
            background: #6a11cb;
            color: white;
            cursor: pointer;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .icon {
            position: absolute;
            cursor: pointer;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #6a11cb;
        }

        #editor-page {
            display: none;
            width: 80%;
            max-width: 800px;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            position: relative;
        }

        #canvas {
            max-width: 100%;
            max-height: 400px;
            border: 1px solid white;
        }

        .overlay-input {
            margin-top: 20px;
        }

        #logout-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px; 
            background: #f44336;
            color: white;
            border-radius: 5px;
            padding: 5px 10px; 
            cursor: pointer;
        }

        #undo-btn {
            margin-top: 10px;
            background: #4caf50;
        }

        .share-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
            cursor: pointer;
            font-size: 1.5rem;
            color: white;
        }

        .share-icons {
            position: absolute;
            top: 10px;
            left: 50px;
            z-index: 10;
            display: none;
            flex-direction: column;
        }

        .share-icons a {
            margin: 5px;
            color: white;
            font-size: 1.5rem;
            transition: transform 0.2s ease-in-out;
        }

        .share-icons a:hover {
            transform: scale(1.2);
        }

        .share-icons.show {
            display: flex;
        }

        .editor-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .download-options {
            display: none;
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
        }

        .download-options button {
            display: block;
            width: 100%;
            margin: 2px 0;
            padding: 8px 12px;
            background: #6a11cb;
            color: white;
            border: none;
            border-radius: 1px;
            cursor: pointer;
        }

        .download-options button:hover {
            background: #8e2de2;
        }

        .download-container {
            position: relative;
            display: inline-block;
        }
        
        .smoke-controls {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        
        .smoke-controls label {
            display: block;
            margin: 5px 0;
        }
        
        .smoke-controls input[type="range"] {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div class="form-container login-form">
            <h1>Login</h1>
            <input type="text" id="login-username" placeholder="Username">
            <div class="password-container">
                <input type="password" id="login-password" placeholder="Password">
                <span class="icon" onclick="togglePassword('login-password', 'login-eye')" id="login-eye">Show</span>
            </div>
            <button onclick="login()">Login</button><br><br>
             <a href="#" onclick="showRegister()">Register</a>
             <a href="#" onclick="showForgotPassword()">| Reset Password</a>
            <p id="error-message" style="color: red; display: none;">Invalid credentials. Please try again.</p>
        </div>

        <!-- Register Form -->
        <div class="form-container register-form">
            <h1>Register</h1>
            <input type="text" id="register-username" placeholder="Username">
            <div class="password-container">
                <input type="password" id="register-password" placeholder="Password">
                <span class="icon" onclick="togglePassword('register-password', 'register-eye')" id="register-eye">Show</span>
            </div>
            <button onclick="register()">Register</button>
            <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
            <p id="register-error-message" style="color: red; display: none;">Username already registered. Please choose another.</p>
        </div>

        <!-- Forgot Password Form -->
        <div class="form-container forgot-password-form">
            <h1>Forgot Password</h1>
            <input type="text" id="forgot-username" placeholder="Username">
            <div class="password-container">
                <input type="password" id="new-password" placeholder="New Password">
                <span class="icon" onclick="togglePassword('new-password', 'new-password-eye')" id="new-password-eye">Show</span>
            </div>
            <button onclick="resetPassword()">Reset Password</button>
            <p>Remember your password? <a href="#" onclick="showLogin()">Login</a></p>
        </div>
    </div>

    <!-- Editor Page -->
    <div id="editor-page">
        <div class="share-btn" onclick="toggleShareOptions()">
            <i class="fas fa-share-alt"></i>
        </div>

        <div class="share-icons" id="share-options">
            <a href="https://wa.me/?text=Check%20this%20out!" target="_blank"><i class="fab fa-whatsapp"></i></a>
            <a href="https://twitter.com/intent/tweet?url=https://yourwebsite.com&text=Check%20this%20out!" target="_blank"><i class="fab fa-twitter"></i></a>  
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://yourwebsite.com" target="_blank"><i class="fab fa-facebook"></i></a>
            <a href="mailto:?subject=Check%20this%20out&body=Hey%20check%20out%20this%20image%20editor!%20https://yourwebsite.com" target="_blank"><i class="fas fa-envelope"></i></a>
            <a href="https://www.snapchat.com" target="_blank"><i class="fab fa-snapchat"></i></a>
        </div>

        <button id="logout-btn" onclick="logout()">Logout</button>
        <h1>EDITOPIA</h1>
        <input type="file" id="upload" accept="image/*" onchange="loadImage(event)"><br>
        <canvas id="canvas" width="800" height="600"></canvas><br>
        <div class="editor-buttons">
            <div class="download-container">
                <button onclick="toggleDownloadOptions()">Download Image</button>
                <div class="download-options" id="download-options">
                    <button onclick="downloadImage('png')">Download as PNG</button>
                    <button onclick="downloadImage('jpg')">Download as JPG</button>
                    <button onclick="downloadImage('svg')">Download as SVG</button>
                </div>
            </div>
            <button onclick="adjustBrightness(10)">Brightness +</button>
            <button onclick="adjustBrightness(-10)">Brightness -</button>
            <button onclick="adjustExposure(10)">Exposure +</button>
            <button onclick="adjustExposure(-10)">Exposure -</button>
            <button onclick="adjustSaturation(10)">Saturation +</button>
            <button onclick="adjustSaturation(-10)">Saturation -</button>
            <button onclick="adjustContrast(10)">Contrast +</button>
            <button onclick="adjustContrast(-10)">Contrast -</button>
            <button onclick="applyVignette()">Apply Vignette</button>
            <button onclick="sharpenImage()">Sharpen</button>
            <button onclick="applyCartoonEffect()">Cartoon Effect</button>
            <button onclick="applyPicEnhancer()">Pic Enhancer</button>
            <button onclick="applyHighQuality()">High Quality</button>
            <button onclick="applyBlur()">Blur</button>
            <button onclick="applyGrayscale()">Grayscale</button>
            <button onclick="applySmokeEffect()">Smoke Effect</button>
            <button id="undo-btn" onclick="undo()">Undo</button>
        </div>
        
        <div class="smoke-controls" id="smoke-controls" style="display: none;">
            <h3>Smoke Effect Controls</h3>
            <label>
                Intensity: <input type="range" id="smoke-intensity" min="1" max="100" value="50">
            </label>
            <label>
                Density: <input type="range" id="smoke-density" min="1" max="100" value="50">
            </label>
            <label>
                Color: <input type="color" id="smoke-color" value="#ffffff">
            </label>
            <button onclick="applySmokeWithSettings()">Apply Smoke</button>
            <button onclick="hideSmokeControls()">Cancel</button>
        </div>
        
        <div class="overlay-input">
            <input type="file" id="overlay-upload" accept="image/*" onchange="loadOverlay(event)">
            <select id="blend-mode">
                <option value="normal">Normal</option>
                <option value="lighten">Lighten</option>
                <option value="overlay">Overlay</option>
                <option value="screen">Screen</option>
            </select>
            <button onclick="applyOverlay()">Apply Overlay</button>
        </div>
        <div>
            <h2>Gradient Tool</h2>
            <input type="color" id="gradient-color1" value="#ff0000">
            <input type="color" id="gradient-color2" value="#0000ff">
            <select id="gradient-type">
                <option value="linear">Linear Gradient</option>
                <option value="radial">Radial Gradient</option>
            </select>
            <button onclick="applyGradient()">Apply Gradient</button>
        </div>
    </div>

    <script>
        const container = document.querySelector(".container");
        const editorPage = document.getElementById("editor-page");
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        let img = new Image();
        let overlayImg = new Image();
        let history = [];
        let redoStack = [];

        window.onload = function() {
            if (localStorage.getItem("loggedIn") === "true") {
                editorPage.style.display = "block";
                container.style.display = "none";
            } else {
                container.style.display = "block";
            }
        };

        function toggleShareOptions() {
            const shareOptions = document.getElementById("share-options");
            shareOptions.classList.toggle("show");
        }

        function toggleDownloadOptions() {
            const downloadOptions = document.getElementById("download-options");
            downloadOptions.style.display = downloadOptions.style.display === "block" ? "none" : "block";
        }

        // Close download options when clicking elsewhere
        document.addEventListener('click', function(event) {
            const downloadOptions = document.getElementById("download-options");
            const downloadBtn = document.querySelector('.download-container button');
            
            if (!downloadOptions.contains(event.target) && event.target !== downloadBtn) {
                downloadOptions.style.display = 'none';
            }
        });

        function showRegister() {
            container.classList.remove("active-forgot");
            container.classList.add("active-register");
        }

        function showLogin() {
            container.classList.remove("active-register");
            container.classList.remove("active-forgot");
        }

        function showForgotPassword() {
            container.classList.remove("active-register");
            container.classList.add("active-forgot");
        }

        function register() {
            const username = document.getElementById("register-username").value;
            const password = document.getElementById("register-password").value;
            const storedUsername = localStorage.getItem("username");

            if (storedUsername === username) {
                document.getElementById("register-error-message").style.display = "block";
            } else {
                localStorage.setItem("username", username);
                localStorage.setItem("password", password);
                alert("Registration successful! Please log in.");
                showLogin();
                document.getElementById("register-error-message").style.display = "none";
            }
        }

        function login() {
            const username = document.getElementById("login-username").value;
            const password = document.getElementById("login-password").value;
            const storedUsername = localStorage.getItem("username");
            const storedPassword = localStorage.getItem("password");

            if (username === storedUsername && password === storedPassword) {
                localStorage.setItem("loggedIn", "true");
                editorPage.style.display = "block";
                container.style.display = "none";
            } else {
                document.getElementById("error-message").style.display = "block";
            }
        }

        function resetPassword() {
            const username = document.getElementById("forgot-username").value;
            const newPassword = document.getElementById("new-password").value;
            const storedUsername = localStorage.getItem("username");

            if (username === storedUsername) {
                localStorage.setItem("password", newPassword);
                alert("Password reset successful! Please log in with your new password.");
                showLogin();
            } else {
                alert("Username not found. Please try again.");
            }
        }

        function logout() {
            localStorage.setItem("loggedIn", "false");
            container.style.display = "block";
            editorPage.style.display = "none";
        }

        function togglePassword(inputId, eyeId) {
            const input = document.getElementById(inputId);
            const eyeIcon = document.getElementById(eyeId);
            if (input.type === "password") {
                input.type = "text";
                eyeIcon.textContent = "Hide";
            } else {
                input.type = "password";
                eyeIcon.textContent = "Show";
            }
        }

        function loadImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
        
        function loadOverlay(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    overlayImg.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        img.onload = function() {
            resetCanvas();
            saveToHistory();
        };

        overlayImg.onload = function() {
            // Just load the overlay, don't apply it yet
        };

        function resetCanvas() {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, 0, 0, img.width, img.height);
        }

        function saveToHistory() {
            history.push(canvas.toDataURL());
            redoStack = [];
        }

        function undo() {
            if (history.length > 1) {
                redoStack.push(history.pop());
                const lastImage = new Image();
                lastImage.src = history[history.length - 1];
                lastImage.onload = function() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(lastImage, 0, 0);
                };
            }
        }

        function downloadImage(format = 'png') {
            const link = document.createElement("a");
            let filename = "edited_image";
            let mimeType = "image/png";
            
            switch(format) {
                case 'jpg':
                    filename += ".jpg";
                    mimeType = "image/jpeg";
                    link.href = canvas.toDataURL(mimeType, 0.9);
                    break;
                case 'svg':
                    filename += ".svg";
                    // Convert canvas to SVG
                    const svgData = canvasToSVG();
                    link.href = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svgData);
                    break;
                default: // png
                    filename += ".png";
                    link.href = canvas.toDataURL();
                    break;
            }
            
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Hide download options after selection
            document.getElementById("download-options").style.display = "none";
        }

        function canvasToSVG() {
            const width = canvas.width;
            const height = canvas.height;
            const dataURL = canvas.toDataURL("image/png");
            
            return `<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <image width="${width}" height="${height}" xlink:href="${dataURL}"/>
</svg>`;
        }

        function applyOverlay() {
            if (overlayImg.src) {
                const blendMode = document.getElementById("blend-mode").value;
                saveToHistory();
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                ctx.globalCompositeOperation = blendMode;
                ctx.drawImage(overlayImg, 0, 0, canvas.width, canvas.height);
                ctx.globalCompositeOperation = "source-over";
            }
        }

        function adjustBrightness(value) {
            saveToHistory();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, Math.max(0, data[i] + value));
                data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + value));
                data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + value));
            }

            ctx.putImageData(imageData, 0, 0);
        }

        function adjustExposure(value) {
            saveToHistory();
            adjustBrightness(value);
        }

        function adjustSaturation(value) {
            saveToHistory();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                const gray = 0.2989 * r + 0.5870 * g + 0.1140 * b;

                data[i] = Math.min(255, gray + (r - gray) * (1 + value / 100));
                data[i + 1] = Math.min(255, gray + (g - gray) * (1 + value / 100));
                data[i + 2] = Math.min(255, gray + (b - gray) * (1 + value / 100));
            }

            ctx.putImageData(imageData, 0, 0);
        }

        function adjustContrast(value) {
            saveToHistory();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                let factor = (259 * (value + 255)) / (255 * (259 - value));
                data[i] = Math.min(255, Math.max(0, factor * (data[i] - 128) + 128));
                data[i + 1] = Math.min(255, Math.max(0, factor * (data[i + 1] - 128) + 128));
                data[i + 2] = Math.min(255, Math.max(0, factor * (data[i + 2] - 128) + 128));
            }

            ctx.putImageData(imageData, 0, 0);
        }

        function applyVignette() {
            saveToHistory();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;

            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const dist = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));
                    const maxDist = Math.sqrt(Math.pow(centerX, 2) + Math.pow(centerY, 2));
                    const intensity = Math.max(0, 1 - dist / maxDist);

                    let idx = (y * width + x) * 4;
                    data[idx] = data[idx] * intensity;
                    data[idx + 1] = data[idx + 1] * intensity;
                    data[idx + 2] = data[idx + 2] * intensity;
                }
            }

            ctx.putImageData(imageData, 0, 0);
        }

        function sharpenImage() {
            saveToHistory();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            const kernel = [
                [0, -1, 0],
                [-1, 5, -1],
                [0, -1, 0]
            ];
            const newData = new Uint8ClampedArray(data);

            for (let y = 1; y < canvas.height - 1; y++) {
                for (let x = 1; x < canvas.width - 1; x++) {
                    let r = 0, g = 0, b = 0;

                    for (let ky = -1; ky <= 1; ky++) {
                        for (let kx = -1; kx <= 1; kx++) {
                            let pixelIdx = ((y + ky) * canvas.width + (x + kx)) * 4;
                            r += data[pixelIdx] * kernel[ky + 1][kx + 1];
                            g += data[pixelIdx + 1] * kernel[ky + 1][kx + 1];
                            b += data[pixelIdx + 2] * kernel[ky + 1][kx + 1];
                        }
                    }

                    let idx = (y * canvas.width + x) * 4;
                    newData[idx] = Math.min(255, Math.max(0, r));
                    newData[idx + 1] = Math.min(255, Math.max(0, g));
                    newData[idx + 2] = Math.min(255, Math.max(0, b));
                }
            }

            ctx.putImageData(new ImageData(newData, canvas.width, canvas.height), 0, 0);
        }

        function applyCartoonEffect() {
            saveToHistory();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.round(data[i] / 255) * 255;
                data[i + 1] = Math.round(data[i + 1] / 255) * 255;
                data[i + 2] = Math.round(data[i + 2] / 255) * 255;
            }

            ctx.putImageData(imageData, 0, 0);
        }

        function applyPicEnhancer() {
            saveToHistory();
            adjustSaturation(20);
            adjustContrast(20);
        }

        function applyHighQuality() {
            saveToHistory();
            adjustBrightness(30);
            adjustExposure(30);
            adjustContrast(30);
        }

        function applyGrayscale() {
            saveToHistory();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                const gray = 0.399 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2];
                data[i] = gray;
                data[i + 1] = gray;
                data[i + 2] = gray;
            }

            ctx.putImageData(imageData, 0, 0);
        }

        function applyGradient() {
            saveToHistory();
            const color1 = document.getElementById("gradient-color1").value;
            const color2 = document.getElementById("gradient-color2").value;
            const gradientType = document.getElementById("gradient-type").value;

            let gradient;
            if (gradientType === "linear") {
                gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            } else {
                gradient = ctx.createRadialGradient(
                    canvas.width / 2, canvas.height / 2, 0,
                    canvas.width / 2, canvas.height / 2, 
                    Math.max(canvas.width, canvas.height) / 2
                );
            }

            gradient.addColorStop(0, color1);
            gradient.addColorStop(1, color2);

            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.globalCompositeOperation = "multiply";
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            ctx.globalCompositeOperation = "source-over";
        }

        function applyBlur() {
            saveToHistory();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            const width = canvas.width;
            const height = canvas.height;
            const radius = 1;

            const blurredData = new Uint8ClampedArray(data.length);

            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    let r = 0, g = 0, b = 0, count = 0;

                    for (let dy = -radius; dy <= radius; dy++) {
                        for (let dx = -radius; dx <= radius; dx++) {
                            const nx = x + dx;
                            const ny = y + dy;

                            if (nx >= 0 && nx < width && ny >= 0 && ny < height) {
                                const idx = (ny * width + nx) * 4;
                                r += data[idx];
                                g += data[idx + 1];
                                b += data[idx + 2];
                                count++;
                            }
                        }
                    }

                    const idx = (y * width + x) * 4;
                    blurredData[idx] = r / count;
                    blurredData[idx + 1] = g / count;
                    blurredData[idx + 2] = b / count;
                    blurredData[idx + 3] = data[idx + 3];
                }
            }

            ctx.putImageData(new ImageData(blurredData, width, height), 0, 0);
        }
        
        // Smoke Effect Functions
        function applySmokeEffect() {
            document.getElementById("smoke-controls").style.display = "block";
        }
        
        function hideSmokeControls() {
            document.getElementById("smoke-controls").style.display = "none";
        }
        
        function applySmokeWithSettings() {
            saveToHistory();
            const intensity = parseInt(document.getElementById("smoke-intensity").value) / 20;
            const density = parseInt(document.getElementById("smoke-density").value) / 100;
            const color = document.getElementById("smoke-color").value;
            
            // Create a temporary canvas for the smoke effect
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            
            // Draw the current canvas content
            tempCtx.drawImage(canvas, 0, 0);
            
            // Generate smoke particles
            const particleCount = Math.floor(canvas.width * canvas.height * density / 1000);
            
            // Convert hex color to RGB
            const rgb = hexToRgb(color);
            
            for (let i = 0; i < particleCount; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const size = Math.random() * intensity * 10 + 5;
                const opacity = Math.random() * 0.5 + 0.1;
                
                tempCtx.globalAlpha = opacity;
                tempCtx.fillStyle = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${opacity})`;
                
                // Draw a smoke particle (as a circle with blur)
                tempCtx.beginPath();
                tempCtx.arc(x, y, size, 0, Math.PI * 2);
                tempCtx.fill();
                
                // Add some blur effect to the smoke
                tempCtx.filter = 'blur(5px)';
                tempCtx.beginPath();
                tempCtx.arc(x, y, size * 0.8, 0, Math.PI * 2);
                tempCtx.fill();
                tempCtx.filter = 'none';
            }
            
            // Draw the smoke effect over the original image with lighten blend mode
            ctx.globalCompositeOperation = 'lighten';
            ctx.drawImage(tempCanvas, 0, 0);
            ctx.globalCompositeOperation = 'source-over';
            
            hideSmokeControls();
        }
        
        function hexToRgb(hex) {
            // Remove # if present
            hex = hex.replace('#', '');
            
            // Parse r, g, b values
            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);
            
            return { r, g, b };
        }
    </script>
</body>
</html>